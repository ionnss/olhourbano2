{{define "report_detail_content"}}
<div class="report-detail-container">
    <div class="container my-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Back Button - styled like map page -->
                <div class="mb-4">
                    <a href="/feed" class="btn shadow rounded-pill d-flex align-items-center px-3 py-2"
                       style="font-weight:600; letter-spacing:0.5px; font-size:1.08rem; border-radius:999px; box-shadow:0 2px 8px rgba(51,51,51,0.8) !important; background-color:rgb(51, 51, 51); color:#fff; text-decoration:none; display:inline-flex; width:fit-content;">
                        <i class="bi bi-arrow-left me-2"></i>
                        Voltar ao Feed
                    </a>
                </div>

                <!-- Report Card -->
                <div class="report-detail-card">
                    <!-- Report Header -->
                    <div class="report-detail-header">
                        <div class="report-category">
                            <span class="category-icon">{{.Category.Icon}}</span>
                            <span class="category-name">{{.Category.Name}}</span>
                        </div>
                        <div class="report-status">
                            <span class="status-badge status-{{.Report.Status}}">{{.StatusText}}</span>
                        </div>
                    </div>

                    <!-- Report ID and Date -->
                    <div class="report-meta-info">
                        <div class="report-id">
                            <i class="bi bi-hash text-muted me-2"></i>
                            <span class="text-muted">Denúncia #{{.ReportID}}</span>
                        </div>
                        <div class="report-date">
                            <i class="bi bi-calendar3 text-muted me-2"></i>
                            <span class="text-muted">{{.Report.CreatedAt.Format "02/01/2006 às 15:04"}}</span>
                        </div>
                        <div class="report-author">
                            <i class="bi bi-eye-fill text-muted me-2"></i>
                            <span class="text-muted">OlhoUrbano{{if .HashedCPFDisplay}}{{.HashedCPFDisplay}}{{else}}[Anônimo]{{end}}</span>
                        </div>
                    </div>

                    <!-- Location -->
                    <div class="report-location mb-4">
                        <h6><i class="bi bi-geo-alt-fill text-muted me-2"></i>Localização</h6>
                        <p class="location-text">{{.Report.Location}}</p>
                    </div>
                </div>
            </div>
        </div>
        
                <!-- Full-width map section -->
        {{if and .Report.Latitude .Report.Longitude}}
        <div class="row">
            <div class="col-12">
                <div id="mapContainer" class="mt-3">
                    <div id="map" style="height: 300px; border-radius: 12px; width: 100%; border: none; margin-bottom: 0;" 
                         data-latitude="{{.Report.Latitude}}" 
                         data-longitude="{{.Report.Longitude}}"></div>
                </div>
            </div>
        </div>
        {{end}}
        
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="report-detail-card">

                    <!-- Description -->
                    <div class="report-description mb-4">
                        <h6><i class="bi bi-chat-text-fill text-muted me-2"></i>Descrição</h6>
                        <p class="description-text">{{.Report.Description}}</p>
                    </div>

                    <!-- Transport Info (if available) -->
                    {{if .Report.TransportType}}
                    <div class="report-transport mb-4">
                        <h6><i class="bi bi-bus-front text-muted me-2"></i>Informações de Transporte</h6>
                        <div class="transport-info">
                            <span class="transport-type">{{.TransportTypeName}}</span>
                            {{if .TransportDetails}}
                            <div class="transport-details mt-2">
                                <small class="text-muted">{{.TransportDetails}}</small>
                            </div>
                            {{end}}
                        </div>
                    </div>
                    {{end}}

                    <!-- Photos/Videos -->
                    {{if .Photos}}
                    <div class="report-media mb-4">
                        <h6><i class="bi bi-images text-muted me-2"></i>Evidências</h6>
                        <div class="media-gallery">
                            {{range $index, $photo := .Photos}}
                            {{if $photo}}
                            <div class="media-item" onclick="openFileModal('/{{$photo}}', '{{$photo}}', '{{getFileType $photo}}')" style="cursor: pointer;">
                                {{if isImageFile $photo}}
                                    <!-- Image file - show actual image -->
                                    <img src="/{{$photo}}" alt="Evidência {{add $index 1}}" class="media-thumbnail" loading="lazy">
                                {{else if isVideoFile $photo}}
                                    <!-- Video file - show thumbnail or icon -->
                                    {{$thumbnailPath := getThumbnailPath $photo}}
                                    {{if $thumbnailPath}}
                                        <img src="/thumbnails/{{getThumbnailFilename $photo}}" alt="Vídeo {{add $index 1}}" class="media-thumbnail" loading="lazy">
                                    {{else}}
                                        <div class="media-thumbnail media-icon-thumbnail">
                                            <i class="bi bi-camera-video-fill"></i>
                                        </div>
                                    {{end}}
                                {{else if isPdfFile $photo}}
                                    <!-- PDF file - show thumbnail or icon -->
                                    {{$thumbnailPath := getThumbnailPath $photo}}
                                    {{if $thumbnailPath}}
                                        <img src="/thumbnails/{{getThumbnailFilename $photo}}" alt="PDF {{add $index 1}}" class="media-thumbnail" loading="lazy">
                                    {{else}}
                                        <div class="media-thumbnail media-icon-thumbnail">
                                            <i class="bi bi-file-pdf-fill"></i>
                                        </div>
                                    {{end}}
                                {{else}}
                                    <!-- Other document types - show icon -->
                                    <div class="media-thumbnail media-icon-thumbnail">
                                        <i class="bi {{getFileTypeIcon $photo}}"></i>
                                    </div>
                                {{end}}
                                <div class="media-overlay-hover">
                                    <i class="bi bi-eye-fill"></i>
                                </div>
                            </div>
                            {{end}}
                            {{end}}
                        </div>
                    </div>
                    {{end}}

                    <!-- Vote Section -->
                    <div class="vote-section">
                        <div class="vote-action">
                            <button class="action-btn vote-btn" data-report-id="{{.ReportID}}">
                                <i class="bi bi-hand-thumbs-up-fill me-1"></i>
                                Votar
                                <span class="vote-shield">
                                    <span class="vote-count">{{.Report.VoteCount}}</span>
                                </span>
                            </button>
                        </div>
                    </div>

                    <!-- Report Actions - Map and Share buttons -->
                    <div class="report-actions mt-4 mb-4">
                        <a href="/map{{if and .Report.Latitude .Report.Longitude}}?focus_lat={{.Report.Latitude}}&focus_lng={{.Report.Longitude}}&focus_id={{.ReportID}}{{end}}" class="action-btn">
                            <i class="bi bi-map me-2"></i>
                            Ver no Mapa
                        </a>
                        <button class="action-btn share-btn" onclick="shareReport()" data-report-id="{{.ReportID}}">
                            <i class="bi bi-share me-2" style="color: #ffffff !important;"></i>
                            Compartilhar
                        </button>
                    </div>

                    <!-- Comments Section -->
                    {{template "comments_section" .}}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Google Maps Script -->
{{if and .Report.Latitude .Report.Longitude}}
<script src="/static/js/report-detail.js"></script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{.GoogleMapsAPIKey}}&callback=initReportDetailMap&loading=async&libraries=marker">
</script>
{{end}}
{{end}} 