{{define "filter_stats_panel"}}
<!-- Corner button to open lateral panel -->
<div id="feed-corner-button">
  <button id="corner-btn" onclick="togglePanel(); event.stopPropagation();"
    class="btn shadow d-flex align-items-center justify-content-center"
    style="width:50px; height:50px; border-radius:12px 0 0 12px; background-color:rgb(51, 51, 51); color:#fff; border:none; box-shadow:-2px 2px 8px rgba(51,51,51,0.8);">
    <i class="bi bi-three-dots-vertical" style="font-size:1.2rem;"></i>
  </button>
</div>

<!-- Lateral Semi-Page Panel -->
<div id="lateral-panel" style="position:fixed; top:0; right:-400px; width:400px; height:100vh; background:white; box-shadow:-4px 0 20px rgba(0,0,0,0.15); z-index:1002; transition:right 0.3s ease; overflow-y:auto;">
  <!-- Panel Header -->
  <div style="padding:20px; border-bottom:1px solid #e9ecef; background:#f8f9fa;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h5 style="margin:0; font-weight:600; color:#333;">Filtros & Estatísticas</h5>
      <button onclick="toggleLateralPanel()" style="background:none; border:none; font-size:1.5rem; color:#666; cursor:pointer;">
        <i class="bi bi-x"></i>
      </button>
    </div>
  </div>

  <!-- Panel Content -->
  <div style="padding:20px;">
    <!-- Filters Section -->
    <div style="margin-bottom:30px;">
      <h6 style="font-weight:600; color:#333; margin-bottom:15px;">
        <i class="bi bi-funnel me-2"></i>Filtros
      </h6>
      
      <form id="lateral-filter-form" method="GET" action="/feed">
        <div style="margin-bottom:15px;">
          <label for="lateral-category" style="display:block; margin-bottom:5px; font-weight:500; font-size:0.9rem;">Categoria:</label>
          <select id="lateral-category" name="category" class="form-select" style="width:100%; font-size:0.9rem;">
            <option value="">Todas as categorias</option>
            {{range .Categories}}
            <option value="{{.ID}}" {{if eq $.Category .ID}}selected{{end}}>
              {{.Icon}} {{.Name}}
            </option>
            {{end}}
          </select>
        </div>
        
        <div style="margin-bottom:15px;">
          <label for="lateral-status" style="display:block; margin-bottom:5px; font-weight:500; font-size:0.9rem;">Status:</label>
          <select id="lateral-status" name="status" class="form-select" style="width:100%; font-size:0.9rem;">
            <option value="">Todos os status</option>
            <option value="pending" {{if eq $.Status "pending"}}selected{{end}}>Pendente</option>
            <option value="approved" {{if eq $.Status "approved"}}selected{{end}}>Resolvida</option>
          </select>
        </div>
        
        <div style="margin-bottom:15px;">
          <label for="lateral-city" style="display:block; margin-bottom:5px; font-weight:500; font-size:0.9rem;">Cidade:</label>
          <select id="lateral-city" name="city" class="form-select" style="width:100%; font-size:0.9rem;">
            <option value="">Todas as cidades</option>
            {{range .Cities}}
            <option value="{{.}}" {{if eq $.City .}}selected{{end}}>{{.}}</option>
            {{end}}
          </select>
        </div>
        
        <div style="margin-bottom:20px;">
          <label for="lateral-sort" style="display:block; margin-bottom:5px; font-weight:500; font-size:0.9rem;">Ordenar por:</label>
          <select id="lateral-sort" name="sort" class="form-select" style="width:100%; font-size:0.9rem;">
            <option value="recent" {{if eq $.Sort "recent"}}selected{{end}}>Mais Recentes</option>
            <option value="votes" {{if eq $.Sort "votes"}}selected{{end}}>Mais Votadas</option>
            <option value="oldest" {{if eq $.Sort "oldest"}}selected{{end}}>Mais Antigas</option>
          </select>
        </div>
        
        <div style="display:flex; gap:10px;">
          <button type="submit" class="btn btn-primary" style="flex:1; font-size:0.9rem;">Aplicar</button>
          <button type="button" onclick="clearLateralFilters()" class="btn btn-outline-secondary" style="font-size:0.9rem;">Limpar</button>
        </div>
      </form>
    </div>

    <!-- Navigation Button -->
    <div style="margin-bottom:30px;">
      {{if eq .CurrentPage "map"}}
        <a href="/feed" 
          class="btn w-100 d-flex align-items-center justify-content-center"
          style="background-color:#007bff; color:white; border-radius:8px; padding:12px; text-decoration:none; font-weight:500;">
          <i class="bi bi-list-ul me-2"></i> Ver no Feed
        </a>
      {{else}}
        <a href="/map" 
          class="btn w-100 d-flex align-items-center justify-content-center"
          style="background-color:#007bff; color:white; border-radius:8px; padding:12px; text-decoration:none; font-weight:500;">
          <i class="bi bi-map me-2"></i> Ver no Mapa
        </a>
      {{end}}
    </div>

    <!-- Statistics Section -->
    <div style="margin-bottom:30px;">
      <h6 style="font-weight:600; color:#333; margin-bottom:20px; display:flex; align-items:center;">
        <i class="bi bi-graph-up me-2" style="color:#007bff;"></i>Estatísticas
      </h6>
      
      <!-- Professional Stats Cards -->
      <div style="display:flex; flex-direction:column; gap:12px;">
        <!-- Total Reports Card -->
        <div style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:12px; padding:16px; color:white; position:relative; overflow:hidden;">
          <div style="position:absolute; top:-10px; right:-10px; width:60px; height:60px; background:rgba(255,255,255,0.1); border-radius:50%;"></div>
          <div style="position:relative; z-index:1;">
            <div style="font-size:0.85rem; opacity:0.9; margin-bottom:4px;">Total de Denúncias</div>
            <div style="font-size:2rem; font-weight:700; margin-bottom:4px;">{{.TotalReports}}</div>
            <div style="font-size:0.75rem; opacity:0.8;">Todas as categorias</div>
          </div>
        </div>

        <!-- Resolved Reports Card -->
        <div style="background:linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius:12px; padding:16px; color:white; position:relative; overflow:hidden;">
          <div style="position:absolute; top:-10px; right:-10px; width:60px; height:60px; background:rgba(255,255,255,0.1); border-radius:50%;"></div>
          <div style="position:relative; z-index:1;">
            <div style="font-size:0.85rem; opacity:0.9; margin-bottom:4px;">Denúncias Resolvidas</div>
            <div style="font-size:2rem; font-weight:700; margin-bottom:4px;">{{.Resolved}}</div>
            <div style="font-size:0.75rem; opacity:0.8;">Problemas solucionados</div>
          </div>
        </div>

        <!-- This Month Card -->
        <div style="background:linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius:12px; padding:16px; color:white; position:relative; overflow:hidden;">
          <div style="position:absolute; top:-10px; right:-10px; width:60px; height:60px; background:rgba(255,255,255,0.1); border-radius:50%;"></div>
          <div style="position:relative; z-index:1;">
            <div style="font-size:0.85rem; opacity:0.9; margin-bottom:4px;">Este Mês</div>
            <div style="font-size:2rem; font-weight:700; margin-bottom:4px;">{{.ThisMonth}}</div>
            <div style="font-size:0.75rem; opacity:0.8;">Denúncias recentes</div>
          </div>
        </div>

        <!-- Resolution Rate Card -->
        <div style="background:#f8f9fa; border:1px solid #e9ecef; border-radius:12px; padding:16px;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
            <div style="font-size:0.9rem; font-weight:600; color:#333;">Taxa de Resolução</div>
            <div style="font-size:1.1rem; font-weight:700; color:#28a745;">
              {{if gt .TotalReports 0}}
                {{if gt .Resolved 0}}
                  {{.Resolved}}/{{.TotalReports}}
                {{else}}
                  0/{{.TotalReports}}
                {{end}}
              {{else}}
                0/0
              {{end}}
            </div>
          </div>
          <div style="background:#e9ecef; border-radius:8px; height:8px; overflow:hidden;">
            {{if gt .TotalReports 0}}
              {{if gt .Resolved 0}}
                <div style="background:linear-gradient(90deg, #28a745, #20c997); height:100%; width:50%; border-radius:8px; transition:width 0.6s ease;"></div>
              {{end}}
            {{end}}
          </div>
          <div style="font-size:0.75rem; color:#666; margin-top:6px; text-align:center;">
            {{.Resolved}} de {{.TotalReports}} denúncias resolvidas
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mobile Bottom Panel (hidden on desktop) -->
<div id="mobile-bottom-panel" style="position:fixed; bottom:-100vh; left:0; width:100%; height:80vh; background:white; border-radius:20px 20px 0 0; box-shadow:0 -4px 20px rgba(0,0,0,0.15); z-index:1002; transition:bottom 0.3s ease; overflow-y:auto; display:none;">
  <!-- Mobile Panel Header -->
  <div style="padding:20px; border-bottom:1px solid #e9ecef; background:#f8f9fa; border-radius:20px 20px 0 0;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h5 style="margin:0; font-weight:600; color:#333;">Filtros & Estatísticas</h5>
      <button onclick="toggleMobilePanel()" style="background:none; border:none; font-size:1.5rem; color:#666; cursor:pointer;">
        <i class="bi bi-x"></i>
      </button>
    </div>
  </div>

  <!-- Mobile Panel Content (same as lateral panel) -->
  <div style="padding:20px;">
    <!-- Filters Section -->
    <div style="margin-bottom:30px;">
      <h6 style="font-weight:600; color:#333; margin-bottom:15px;">
        <i class="bi bi-funnel me-2"></i>Filtros
      </h6>
      
      <form id="mobile-filter-form" method="GET" action="/feed">
        <div style="margin-bottom:15px;">
          <label for="mobile-category" style="display:block; margin-bottom:5px; font-weight:500; font-size:0.9rem;">Categoria:</label>
          <select id="mobile-category" name="category" class="form-select" style="width:100%; font-size:0.9rem;">
            <option value="">Todas as categorias</option>
            {{range .Categories}}
            <option value="{{.ID}}" {{if eq $.Category .ID}}selected{{end}}>
              {{.Icon}} {{.Name}}
            </option>
            {{end}}
          </select>
        </div>
        
        <div style="margin-bottom:15px;">
          <label for="mobile-status" style="display:block; margin-bottom:5px; font-weight:500; font-size:0.9rem;">Status:</label>
          <select id="mobile-status" name="status" class="form-select" style="width:100%; font-size:0.9rem;">
            <option value="">Todos os status</option>
            <option value="pending" {{if eq $.Status "pending"}}selected{{end}}>Pendente</option>
            <option value="approved" {{if eq $.Status "approved"}}selected{{end}}>Resolvida</option>
          </select>
        </div>
        
        <div style="margin-bottom:15px;">
          <label for="mobile-city" style="display:block; margin-bottom:5px; font-weight:500; font-size:0.9rem;">Cidade:</label>
          <select id="mobile-city" name="city" class="form-select" style="width:100%; font-size:0.9rem;">
            <option value="">Todas as cidades</option>
            {{range .Cities}}
            <option value="{{.}}" {{if eq $.City .}}selected{{end}}>{{.}}</option>
            {{end}}
          </select>
        </div>
        
        <div style="margin-bottom:20px;">
          <label for="mobile-sort" style="display:block; margin-bottom:5px; font-weight:500; font-size:0.9rem;">Ordenar por:</label>
          <select id="mobile-sort" name="sort" class="form-select" style="width:100%; font-size:0.9rem;">
            <option value="recent" {{if eq $.Sort "recent"}}selected{{end}}>Mais Recentes</option>
            <option value="votes" {{if eq $.Sort "votes"}}selected{{end}}>Mais Votadas</option>
            <option value="oldest" {{if eq $.Sort "oldest"}}selected{{end}}>Mais Antigas</option>
          </select>
        </div>
        
        <div style="display:flex; gap:10px;">
          <button type="submit" class="btn btn-primary" style="flex:1; font-size:0.9rem;">Aplicar</button>
          <button type="button" onclick="clearMobileFilters()" class="btn btn-outline-secondary" style="font-size:0.9rem;">Limpar</button>
        </div>
      </form>
    </div>

    <!-- Navigation Button -->
    <div style="margin-bottom:30px;">
      {{if eq .CurrentPage "map"}}
        <a href="/feed" 
          class="btn w-100 d-flex align-items-center justify-content-center"
          style="background-color:#007bff; color:white; border-radius:8px; padding:12px; text-decoration:none; font-weight:500;">
          <i class="bi bi-list-ul me-2"></i> Ver no Feed
        </a>
      {{else}}
        <a href="/map" 
          class="btn w-100 d-flex align-items-center justify-content-center"
          style="background-color:#007bff; color:white; border-radius:8px; padding:12px; text-decoration:none; font-weight:500;">
          <i class="bi bi-map me-2"></i> Ver no Mapa
        </a>
      {{end}}
    </div>

    <!-- Statistics Section -->
    <div style="margin-bottom:30px;">
      <h6 style="font-weight:600; color:#333; margin-bottom:20px; display:flex; align-items:center;">
        <i class="bi bi-graph-up me-2" style="color:#007bff;"></i>Estatísticas
      </h6>
      
      <!-- Professional Stats Cards -->
      <div style="display:flex; flex-direction:column; gap:12px;">
        <!-- Total Reports Card -->
        <div style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:12px; padding:16px; color:white; position:relative; overflow:hidden;">
          <div style="position:absolute; top:-10px; right:-10px; width:60px; height:60px; background:rgba(255,255,255,0.1); border-radius:50%;"></div>
          <div style="position:relative; z-index:1;">
            <div style="font-size:0.85rem; opacity:0.9; margin-bottom:4px;">Total de Denúncias</div>
            <div style="font-size:2rem; font-weight:700; margin-bottom:4px;">{{.TotalReports}}</div>
            <div style="font-size:0.75rem; opacity:0.8;">Todas as categorias</div>
          </div>
        </div>

        <!-- Resolved Reports Card -->
        <div style="background:linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius:12px; padding:16px; color:white; position:relative; overflow:hidden;">
          <div style="position:absolute; top:-10px; right:-10px; width:60px; height:60px; background:rgba(255,255,255,0.1); border-radius:50%;"></div>
          <div style="position:relative; z-index:1;">
            <div style="font-size:0.85rem; opacity:0.9; margin-bottom:4px;">Denúncias Resolvidas</div>
            <div style="font-size:2rem; font-weight:700; margin-bottom:4px;">{{.Resolved}}</div>
            <div style="font-size:0.75rem; opacity:0.8;">Problemas solucionados</div>
          </div>
        </div>

        <!-- This Month Card -->
        <div style="background:linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius:12px; padding:16px; color:white; position:relative; overflow:hidden;">
          <div style="position:absolute; top:-10px; right:-10px; width:60px; height:60px; background:rgba(255,255,255,0.1); border-radius:50%;"></div>
          <div style="position:relative; z-index:1;">
            <div style="font-size:0.85rem; opacity:0.9; margin-bottom:4px;">Este Mês</div>
            <div style="font-size:2rem; font-weight:700; margin-bottom:4px;">{{.ThisMonth}}</div>
            <div style="font-size:0.75rem; opacity:0.8;">Denúncias recentes</div>
          </div>
        </div>

        <!-- Resolution Rate Card -->
        <div style="background:#f8f9fa; border:1px solid #e9ecef; border-radius:12px; padding:16px;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
            <div style="font-size:0.9rem; font-weight:600; color:#333;">Taxa de Resolução</div>
            <div style="font-size:1.1rem; font-weight:700; color:#28a745;">
              {{if gt .TotalReports 0}}
                {{if gt .Resolved 0}}
                  {{.Resolved}}/{{.TotalReports}}
                {{else}}
                  0/{{.TotalReports}}
                {{end}}
              {{else}}
                0/0
              {{end}}
            </div>
          </div>
          <div style="background:#e9ecef; border-radius:8px; height:8px; overflow:hidden;">
            {{if gt .TotalReports 0}}
              {{if gt .Resolved 0}}
                <div style="background:linear-gradient(90deg, #28a745, #20c997); height:100%; width:50%; border-radius:8px; transition:width 0.6s ease;"></div>
              {{end}}
            {{end}}
          </div>
          <div style="font-size:0.75rem; color:#666; margin-top:6px; text-align:center;">
            {{.Resolved}} de {{.TotalReports}} denúncias resolvidas
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Overlay for mobile -->
<div id="mobile-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1001; display:none;"></div>

<!-- Statistics Modal -->
<div class="modal fade" id="statsModal" tabindex="-1" aria-labelledby="statsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="statsModalLabel">
                    <i class="bi bi-graph-up me-2"></i>Estatísticas Detalhadas
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Main Stats -->
                    <div class="col-md-6 mb-4">
                        <div class="stats-card">
                            <h6 class="text-primary mb-3">Resumo Geral</h6>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <span class="stat-number">{{.TotalReports}}</span>
                                    <span class="stat-label">Total de Denúncias</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">{{.ThisMonth}}</span>
                                    <span class="stat-label">Este Mês</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">{{.Resolved}}</span>
                                    <span class="stat-label">Resolvidas</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">{{.Pending}}</span>
                                    <span class="stat-label">Pendentes</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Stats -->
                    <div class="col-md-6 mb-4">
                        <div class="stats-card">
                            <h6 class="text-success mb-3">Taxa de Resolução</h6>
                            <div class="resolution-rate">
                                {{if gt .TotalReports 0}}
                                    <div class="progress mb-3" style="height: 25px;">
                                        <div class="progress-bar bg-success" role="progressbar" 
                                             data-width="{{.ResolutionRate}}"
                                             aria-valuenow="{{.ResolutionRate}}" 
                                             aria-valuemin="0" aria-valuemax="100">
                                            {{.ResolutionRate}}%
                                        </div>
                                    </div>
                                    <p class="text-muted mb-0">
                                        <strong>{{.Resolved}}</strong> de <strong>{{.TotalReports}}</strong> denúncias foram resolvidas
                                    </p>
                                {{else}}
                                    <p class="text-muted">Nenhuma denúncia registrada ainda.</p>
                                {{end}}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Category Breakdown (if available) -->
                <div class="row">
                    <div class="col-12">
                        <div class="stats-card">
                            <h6 class="text-info mb-3">Atividade Recente</h6>
                            <div class="activity-summary">
                                <p class="mb-2">
                                    <i class="bi bi-calendar-event me-2"></i>
                                    <strong>{{.ThisMonth}}</strong> denúncias foram feitas este mês
                                </p>
                                <p class="mb-0">
                                    <i class="bi bi-clock-history me-2"></i>
                                    A plataforma está ativa e recebendo denúncias regularmente
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                {{if eq .CurrentPage "map"}}
                  <a href="/feed" class="btn btn-primary">
                      <i class="bi bi-list-ul me-2"></i>Ver no Feed
                  </a>
                {{else}}
                  <a href="/map" class="btn btn-primary">
                      <i class="bi bi-map me-2"></i>Ver no Mapa
                  </a>
                {{end}}
            </div>
        </div>
    </div>
</div>
{{end}} 